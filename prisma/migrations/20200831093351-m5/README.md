# Migration `20200831093351-m5`

This migration has been generated by sebastianrcnt at 8/31/2020, 6:33:51 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
PRAGMA foreign_keys=OFF;

ALTER TABLE "Experiment" ADD COLUMN "json" TEXT  DEFAULT '{}';

CREATE TABLE "new_Result" (
"experimentId" TEXT ,
"projectId" TEXT ,
"userEmail" TEXT ,
"timestamp" TEXT ,
"id" INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT,
"done" INTEGER NOT NULL DEFAULT 0,
FOREIGN KEY ("experimentId") REFERENCES "Experiment"("id") ON DELETE SET NULL ON UPDATE CASCADE,

FOREIGN KEY ("projectId") REFERENCES "Project"("id") ON DELETE SET NULL ON UPDATE CASCADE,

FOREIGN KEY ("userEmail") REFERENCES "User"("email") ON DELETE SET NULL ON UPDATE CASCADE
)

INSERT INTO "new_Result" ("experimentId", "projectId", "timestamp", "id", "done", "userEmail") SELECT "experimentId", "projectId", "timestamp", "id", "done", "userEmail" FROM "Result"

PRAGMA foreign_keys=off;
DROP TABLE "Result";;
PRAGMA foreign_keys=on

ALTER TABLE "new_Result" RENAME TO "Result";

PRAGMA foreign_key_check;

PRAGMA foreign_keys=ON;
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20200831085612-m4..20200831093351-m5
--- datamodel.dml
+++ datamodel.dml
@@ -3,9 +3,9 @@
 }
 datasource db {
   provider = "sqlite"
-  url = "***"
+  url = "***"
 }
 model Experiment {
   id          String    @default("unset") @id
@@ -13,8 +13,9 @@
   name        String    @default("unset")
   description String?
   fileId      String    @default("unset")
   fileName    String?
+  json        String?   @default("{}")
   User        User?     @relation(fields: [userEmail], references: [email])
   Results     Result[]
   Projects    Project[]
 }
@@ -45,9 +46,8 @@
 model Result {
   experimentId String?
   projectId    String?
   userEmail    String?
-  json         String?     @default("{}")
   timestamp    String?
   id           Int         @default(autoincrement()) @id
   done         Int         @default(0)
   Experiment   Experiment? @relation(fields: [experimentId], references: [id])
```


